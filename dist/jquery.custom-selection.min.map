{"version":3,"file":"jquery.custom-selection.min.js","sources":["jquery.custom-selection.js"],"names":["$","useContextOf","$element","contextDocument","ownerDocument","contextWindow","defaultView","parentWindow","enableTouchSelectionFor","each","Hammer","this","holdThreshold","holdTimeout","on","handleGlobalTouchMove","handleGlobalTouchEnd","hammer","handleGlobalTapHold","clearSelection","disableTouchSelectionFor","off","e","gesture","srcEvent","preventDefault","stopPropagation","isMarker","target","element","getTouchedElementFromEvent","point","getTouchPoint","shift","wrapWithMarkersWordAtPoint","createSelection","rejectTouchEnd","jqueryEvent","handleMarkerTouchMove","lastPoint","originalEvent","frameRequester","requestFrame","eventAnchor","getTouchedElementByPoint","mark","updateSelection","startMarker","endMarker","getSelection","removeAllRanges","detach","selectionDrawer","redrawSelection","hasRangeChanged","range","lastSelectionRange","compareBoundaryPoints","Range","END_TO_END","START_TO_START","force","existInDOM","createRange","setStart","apply","getRangeBoundAt","setEnd","collapsed","addRange","redraw","offset","getIndexOfElement","anchor","parentNode","nextSibling","i","arguments","length","touchEvent","options","CustomSelection","Lib","Point","touches","pointers","touchPoint","hideMarkers","elementFromPoint","clientX","clientY","showMarkers","createMarker","kind","span","createElement","setAttribute","css","visibility","textNode","getFromElNodeContainingPoint","trimTextNodeWhileContainsPoint","putMarkerBeforeWhitespaceOnLeftOf","putMarkerBeforeWhitespaceOnRightOf","normalize","marker","node","nodeEndsWith","WHITESPACE","data","removeLastLetter","previousSibling","nodeIsText","putMarkerBefore","putMarkerAfter","nodeStartsWith","removeFirstLetter","subNode","splitText","letter","el","getClosestTextNodeFromEl","trimPosition","nodeContainsPoint","insertBefore","appendChild","elements","parentElement","childNodes","Array","prototype","indexOf","call","n","nodes","rect","rects","getRectsForNode","j","rectContainsPoint","selectNode","getClientRects","x","y","left","right","top","bottom","nodeType","Node","TEXT_NODE","nodeHasChildren","nearestOnTheLeftOfPoint","getNodeNearerPointOnLeft","bind","nearestAbovePoint","getNodeNearerPointAbove","searchTextNode","comparator","searchNode","closestNode","winner","rival","newWinner","nearestRivalRect","getRectNearestOnLeftOfPoint","nearestWinnerRect","areDifferent","splitNodeAfterRect","nearestRect","rectIsInTheSameLineOnLeft","arg1","arg2","clientRect","lastRect","getRectNearestAbovePoint","settings","defaults","markerClass","window","fn","customSelection","extend","FrameRequester","SelectionDrawer","selectionColor","resize","disableCustomSelection","jQuery","global","_ticking","func","requestAnimationFrame","touch","pageX","pageY","SHIFT_Y","$el","fillStyle","initCanvas","canvas","getCanvas","createCanvas","context","getContext","drawSelection","beginPath","width","height","closePath","fill","lastDrawnRange","clearRect","updateCanvasBounds","style","scrollTop","scrollLeft","document","getElementById","lastTime","vendors","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout"],"mappings":"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"}