/*! CustomSelection - v0.1.0 - 2014-07-22 */
function removeMarkers(){$(".marker").remove(),$(".marker_end").remove()}function requestTick(a){ticking||window.requestAnimationFrame(a),ticking=!0}function createSelection(){var a=document.createRange();a.setStart(startAnchor,startOffset),a.setEnd(endAnchor,endOffset),window.getSelection().addRange(a)}function mark(a,b,c){var d;if(d=getFromElNodeContainingPoint(a,b)){for(;d.length>1;){var e=d.length>>1,f=d.splitText(e);nodeContainsPoint(f,b)&&(d=f)}putMarkerBefore(d,c)}else{if(!(d=getClosestTextNodeFromEl(a,b)))return null;putMarkerAfter(d,c)}return c.parentNode.normalize(),getIndexOfElement(c)}function putMarkerBefore(a,b){a.parentNode.insertBefore(b,a)}function putMarkerAfter(a,b){a.nextSibling?a.parentNode.insertBefore(b,a.nextSibling):a.parentNode.appendChild(b)}function createMarker(a){var b=document.createElement("span");return b.setAttribute("class",a),b}function getIndexOfElement(a){var b=a.parentElement.childNodes;return Array.prototype.indexOf.call(b,a)}function getFromElNodeContainingPoint(a,b){for(var c,d=a.childNodes,e=0;c=d[e++];)if(nodeIsText(c)&&nodeContainsPoint(c,b))return c}function nodeContainsPoint(a,b){for(var c,d=getRectsForNode(a),e=0;c=d[e++];)if(rectContainsPoint(c,b))return!0}function getRectsForNode(a){var b=document.createRange();return b.selectNode(a),b.getClientRects()}function rectContainsPoint(a,b){var c=b.clientX,d=b.clientY;return c>a.left&&c<a.right&&d>a.top&&d<a.bottom}function nodeIsText(a){return a.nodeType===Node.TEXT_NODE&&a.length}function getClosestTextNodeFromEl(a,b){for(var c,d=a;c=getClosestNodeFromEl(d,b);){if(nodeIsText(c))return c;d=c}return null}function getClosestNodeFromEl(a,b){for(var c,d=a.childNodes,e=null,f=0;c=d[f++];){var g;(g=getRectsForNode(c))&&g.length&&(e=e||c,e=getNodeCloserToPoint(b,e,c))}return e}function getNodeCloserToPoint(a,b,c){var d=getRectNearestToPoint(b,a),e=getRectNearestToPoint(c,a);return e&&d&&e!==d&&e.top>=d.top?c:b}function getRectNearestToPoint(a,b){for(var c,d=b.clientY,e=getRectsForNode(a),f=null,g=0;c=e[g++];)c.top<d&&(f=f||c,f!==c&&c.top>=f.top&&(f=c));return f}function logg(a){$(".touch_status").text(a)}function initCanvas(){var a=document.getElementById("debugging");a.width=$(window).width(),a.height=$(window).height(),context=a.getContext("2d")}function drawNode(a){var b=document.createRange();b.selectNode(a);for(var c,d=b.getClientRects(),e=0;c=d[e++];)drawRect(c)}function drawRect(a){context.beginPath(),context.rect(a.left+.5,a.top+.5,a.width,a.height),context.lineWidth=1,context.strokeStyle="red",context.stroke()}function drawCircle(a,b){context.beginPath(),context.arc(a,b,12,0,2*Math.PI,!1),context.lineWidth=2,context.strokeStyle="green",context.stroke()}var startAnchor=null,endAnchor=null,startOffset=null,endOffset=null,startMarker,endMarker,lastPoint,ticking=!1;$(function(){$("body").on("touchstart",function(a){a=a.originalEvent,logg("touchstart: "+a.touches.length),window.getSelection().removeAllRanges(),removeMarkers();var b=a.touches[0],c={clientX:b.clientX,clientY:b.clientY,pageX:b.pageX,pageY:b.pageY},d=a.touches[0].target;startMarker=startMarker||createMarker("marker");var e=mark(d,c,startMarker);e&&(startAnchor=startMarker.parentNode,startOffset=e),a.preventDefault()}).on("touchmove",function(a){a.preventDefault(),a=a.originalEvent,logg("touchmove: "+a.touches[0].clientX+"/"+a.touches[0].clientY);var b=a.touches[0];lastPoint={clientX:b.clientX,clientY:b.clientY,pageX:b.pageX,pageY:b.pageY},requestTick(function(){endMarker=endMarker||createMarker("marker_end");var a=document.elementFromPoint(lastPoint.clientX,lastPoint.clientY),b=mark(a,lastPoint,endMarker);b&&(endAnchor=endMarker.parentNode,endOffset=b),ticking=!1})}).on("touchend",function(a){a=a.originalEvent,logg("touchend: "+a.touches.length),console.log("sA, eA, sO, eO",startAnchor,endAnchor,startOffset,endOffset),createSelection()})});var context;
//# sourceMappingURL=custom-selection.min.map